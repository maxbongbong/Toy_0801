<style>
  .table th{
    text-align:center;
  }
  .table td{
    text-align:center;
    vertical-align:middle;
    padding:unset;
  }
  .block div input{
    margin-top:3px;
  }
</style>
<div class="container" style="padding-top:1.5rem;">
  <h5 class="row px-3 py-3">결제 확인</h5>
  <table class="table border-bottom ">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">이미지</th>
        <th scope="col">상품이름</th>
        <th scope="col">상품정보</th>
        <th scope="col">가격</th>
        <th scope="col">수량</th>
      </tr>
    </thead>
    <tbody>
      <% if @order.present? %>
        <% @order.line_items.each_with_index do |line_item, index|  %>
          <tr>
            <td><%= index+1 %></td>
            <td><%= image_tag(line_item.product.image_url, alt:"", style:"width:70px; height:65px;")%></td>
            <td><%= line_item.product.title %></td>
            <td><%= line_item.product.body %></td>
            <td><strong><%= number_with_delimiter(line_item.product.price) %> 원</strong></td>
            <td><span id="quantity-<%= line_item.id %>"><%= number_with_delimiter(line_item.quantity ? line_item.quantity : 1) %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="6" style="padding-top:20px; padding-bottom:15px;">
          <strong>총 :
            <span id="item-total">
              <%= number_with_delimiter @order.line_items.sum(:amount) %>
            </span>원
          </strong>
        </td>
      </tr>
    </tfoot>
  </table>
  <h5 class="row px-3 py-3">주소 입력</h5>
  <%= form_for @order, url: payment_completed_order_path(@order), method: :post do |f| %>
    <div class="block p-4 border-top">
      <%# <%= f.text_field :address_1, style:"margin-bottom:10px;padding:15px;border:solid 1px lightgray;border-radius:10px;width:700px;"%>
      <div class="button button-outline zipcode_btn col-30 my-3" style="padding-bottom:8px; border-radius:5px;">
        <!-- <input type="text" id="sample4_roadAddress" placeholder="도로명주소" style="width:35rem; padding:5px; border-radius:5px;"> -->
        <%= f.text_field :address_1, id:"sample4_roadAddress", placeholder:"도로명주소", style:"width:35rem; padding:5px; border-radius:5px;" %>
        <!-- <input type="text" id="sample4_postcode" placeholder="우편번호" style="padding:5px; border-radius:5px; margin-left:5rem;"> -->
        <%= f.text_field :post_code, id:"sample4_postcode", placeholder:"우편번호", style:"padding:5px; border-radius:5px; margin-left:5rem;" %>
        <input type="button" class="btn btn-dark" onclick="sample4_execDaumPostcode()" value="우편번호 찾기" style="padding:5px; border-radius:5px; margin-bottom:7px;">
        <!-- <input type="text" id="sample4_jibunAddress" placeholder="지번주소" style="width:35rem; padding:5px; border-radius:5px;"> -->
        <%= f.text_field :address_2, id:"sample4_jibunAddress", placeholder:"지번주소", style:"width:35rem; padding:5px; border-radius:5px;" %>
        <span id="guide" style="color:#999"></span>
        <%= f.text_field :address_3, placeholder: "나머지 주소 입력", style:"margin-bottom:10px; padding:5px; border-radius:5px; width:35rem;"%>
        <%= f.text_field :note, placeholder: "ex) 부재 시 경비실에 맡겨주세요.", style:"width:35rem; padding:5px; border-radius:5px;" %>
        <%= f.hidden_field :state, value: :complete %>
        <%= f.submit "결제하기", class: "btn btn-dark", style:"margin-left:16.7rem; margin-bottom:10px; width:6rem;" %>
      </div>
    </div>
  <% end %>
</div>
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js?autoload=false"></script>
<!-- <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script> -->
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<script>
  $('.iamport-btn').click(function(){
    // var IMP = window.IMP; // 생략가능
    IMP.init('imp37336175')
    IMP.request_pay({
      pg : 'inicis', // version 1.1.0부터 지원.
      pay_method : 'card',
      merchant_uid : 'merchant_' + new Date().getTime(),
      name : '주문명:결제테스트',
      amount : 14000,
      buyer_email : 'iamport@siot.do',
      buyer_name : '구매자이름',
      buyer_tel : '010-1234-5678',
      buyer_addr : '서울특별시 강남구 삼성동',
      buyer_postcode : '123-456',
      m_redirect_url : 'https://www.yourdomain.com/payments/complete'
    }, function(rsp) {
      if ( rsp.success ) {
          var msg = '결제가 완료되었습니다.';
          msg += '고유ID : ' + rsp.imp_uid;
          msg += '상점 거래ID : ' + rsp.merchant_uid;ru
          msg += '결제 금액 : ' + rsp.paid_amount;
          msg += '카드 승인번호 : ' + rsp.apply_num;
      } else {
          var msg = '결제에 실패하였습니다.';
          msg += '에러내용 : ' + rsp.error_msg;
      }
      alert(msg);
    });
  });
</script>
